<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VibeDownloader</title>

<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='images/site.webmanifest') }}">
<meta name="theme-color" content="#121212">

<style>
    /* Estilos Gerais */
    body, html { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; min-height: 100%; display: flex; flex-direction: column; }
    .container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
    
    .downloader-box { 
        background-color: #1e1e1e; padding: 30px; border-radius: 20px; 
        box-shadow: 0 0 40px rgba(0, 255, 127, 0.1); text-align: center; 
        width: 100%; max-width: 500px; position: relative; z-index: 10;
        margin-bottom: 30px;
    }

    /* --- LOGO CLIC√ÅVEL (Reset) --- */
    .logo-link { text-decoration: none; display: inline-block; transition: transform 0.2s; cursor: pointer; }
    .logo-link:hover { transform: scale(1.05); }
    .title { font-size: 2.2em; font-weight: 800; color: #00ff7f; margin: 10px 0 5px 0; text-shadow: 0 0 15px rgba(0, 255, 127, 0.4); letter-spacing: -1px; }

    /* --- PROMO CARD (Indique e Ganhe) --- */
    .promo-card {
        background: linear-gradient(145deg, #1a1a1a, #222);
        border: 1px solid #333;
        border-left: 4px solid #00bfff; /* Azul Cyan */
        padding: 20px;
        border-radius: 12px;
        max-width: 500px;
        width: 100%;
        text-align: left;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        position: relative;
    }
    .promo-title { color: #fff; font-weight: bold; font-size: 1.1em; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
    .promo-text { color: #888; font-size: 0.9em; line-height: 1.4; }
    .promo-highlight { color: #00bfff; font-weight: bold; }

    /* Inputs e Bot√µes */
    .input-wrapper { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; }
    .url-input { flex: 1; padding: 15px; border: 2px solid #333; border-radius: 12px; background-color: #262626; color: #fff; outline: none; transition: 0.3s; font-size: 16px; }
    .url-input:focus { border-color: #00ff7f; background-color: #1a1a1a; }
    
    .btn-icon { width: 45px; height: 45px; border: none; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.4em; font-weight: bold; transition: 0.2s; }
    .btn-add { background-color: #2a2a2a; color: #00ff7f; border: 1px solid #333; }
    .btn-remove { background-color: #2a1a1a; color: #ff5555; border: 1px solid #331a1a; }

    .format-selector { margin: 25px 0; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .format-option { cursor: pointer; position: relative; }
    .format-option input { display: none; }
    .format-option span { padding: 10px 25px; border: 2px solid #333; border-radius: 30px; color: #888; transition: all 0.3s ease; display: inline-block; font-weight: 700; font-size: 0.9em; background: #262626; }
    .format-option input:checked + span { border-color: #00ff7f; color: #000; background-color: #00ff7f; box-shadow: 0 0 20px rgba(0, 255, 127, 0.4); transform: scale(1.05); }

    .btn-action { width: 100%; padding: 18px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; transition: transform 0.2s; font-size: 1.1em; display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 15px; text-decoration: none; text-transform: uppercase; letter-spacing: 1px; }
    .btn-convert { background: linear-gradient(135deg, #00ff7f 0%, #00cc66 100%); color: #050505; }
    .btn-download { background: linear-gradient(135deg, #00bfff 0%, #0088cc 100%); color: #050505; }
    .btn-restart { background-color: #262626; color: #fff; border: 1px solid #333; font-size: 0.9em; padding: 15px; }
    .btn-action:active { transform: scale(0.98); }

    /* Barra de Auth (Login/Registro) */
    .auth-bar { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; width: 100%; max-width: 500px; }
    .btn-auth { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #1e1e1e; color: #ccc; text-decoration: none; text-align: center; font-size: 0.9em; transition: 0.2s; }
    .btn-auth:hover { border-color: #00ff7f; color: #00ff7f; }
    .btn-auth.primary { background: #00ff7f; color: #000; border: none; font-weight: bold; }
    .btn-auth.primary:hover { opacity: 0.9; }

    #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.92); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
    .pulse-ring { width: 80px; height: 80px; border-radius: 50%; background: #00ff7f; box-shadow: 0 0 0 0 rgba(0, 255, 127, 0.7); animation: pulse-green 2s infinite; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; }
    .pulse-ring svg { width: 40px; fill: #000; }
    @keyframes pulse-green { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 255, 127, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 30px rgba(0, 255, 127, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(0, 255, 127, 0); } }
    .loading-text { font-size: 1.5em; font-weight: bold; color: #fff; margin-bottom: 10px; }
    .loading-subtext { color: #888; font-size: 0.9em; }

    .spek-container { margin-top: 20px; background: #000; padding: 10px; border-radius: 12px; border: 1px solid #333; overflow: hidden; }
    .spek-img { width: 100%; border-radius: 8px; display: block; }
    .song-label { color: #fff; font-size: 0.85em; margin-bottom: 8px; text-align: left; font-weight: 600; padding-left: 5px; }
    .flash { padding: 15px; margin-bottom: 20px; border-radius: 10px; background: rgba(255,50,50,0.1); color: #ff8888; border: 1px solid #ff4444; font-size: 0.9em; }
</style>

<script>
    function addInput() {
        const container = document.getElementById('inputs-container');
        if(container.children.length >= 10) { alert('M√°ximo de 10 links por vez!'); return; }
        const div = document.createElement('div');
        div.className = 'input-wrapper';
        div.innerHTML = `
            <input type="text" name="urls[]" class="url-input" placeholder="Outro link..." autocomplete="off">
            <button type="button" class="btn-icon btn-remove" onclick="this.parentElement.remove()">√ó</button>
        `;
        container.appendChild(div);
    }
    
    function startLoading() {
        document.getElementById('loading-overlay').style.display = 'flex';
        const steps = ["Conectando ao servidor...", "Baixando em Alta Qualidade...", "Extraindo √Åudio...", "Processando Espectrograma...", "Compactando Arquivos...", "Quase l√°..."];
        let i = 0;
        const subtext = document.getElementById('loading-subtext');
        setInterval(() => { if (i < steps.length) { subtext.innerText = steps[i]; i++; } }, 3000);
    }
</script>
</head>
<body>

<div id="loading-overlay">
    <div class="pulse-ring">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
    </div>
    <div class="loading-text">AGUARDE</div>
    <div id="loading-subtext" class="loading-subtext">Iniciando processos...</div>
</div>

<div class="container">
    
    <div class="promo-card">
        <div class="promo-title">
            <span style="font-size: 1.5em;">üöÄ</span> 
            <div>Programa de Parceiros DJ</div>
        </div>
        <div class="promo-text">
            Indique um amigo e ganhe <span class="promo-highlight">R$ 5,00 de desconto mensal</span> na sua assinatura PRO. 
            Acumulativo! Se trouxer 5 amigos, sua vibe sai de gra√ßa.
        </div>
    </div>

    <div class="auth-bar">
        <a href="#" class="btn-auth">Fazer Login</a>
        <a href="#" class="btn-auth primary">Criar Conta</a>
    </div>

    <div class="downloader-box">
        <a href="/" class="logo-link">
            <img src="{{ url_for('static', filename='images/android-chrome-192x192.png') }}" style="width: 70px; margin-bottom: 5px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);">
            <h1 class="title" style="margin-top: 0;">VibeDownloader</h1>
        </a>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% if not download_ready %}
        <div id="form-area">
            <form action="/" method="post" onsubmit="startLoading()" autocomplete="off">
                <div id="inputs-container">
                    <div class="input-wrapper">
                        <input type="text" name="urls[]" class="url-input" placeholder="Cole o link (YouTube, SoundCloud...)" required autocomplete="off">
                        <button type="button" class="btn-icon btn-add" onclick="addInput()">+</button>
                    </div>
                </div>

                <div class="format-selector">
                    <label class="format-option">
                        <input type="radio" name="format" value="mp3" checked>
                        <span>MP3 320</span>
                    </label>
                    <label class="format-option">
                        <input type="radio" name="format" value="wav">
                        <span>WAV</span>
                    </label>
                    <label class="format-option">
                        <input type="radio" name="format" value="flac">
                        <span>FLAC</span>
                    </label>
                    <label class="format-option">
                        <input type="radio" name="format" value="aiff">
                        <span>AIFF</span>
                    </label>
                </div>

                <button type="submit" class="btn-action btn-convert">BAIXAR AGORA</button>
            </form>
        </div>
        {% endif %}

        {% if download_ready %}
        <div>
            <h3 style="color: #00ff7f; margin-bottom: 5px; font-size: 1.5em;">Sucesso!</h3>
            
            {% for item in results %}
            <div class="spek-container">
                <div class="song-label">üéµ {{ item.title }}</div>
                {% if item.spectrogram %}
                <img src="{{ url_for('static', filename=item.spectrogram) }}" class="spek-img">
                {% endif %}
            </div>
            {% endfor %}

            <a href="{{ url_for('download_file', filename=final_filename) }}" class="btn-action btn-download">
                {% if is_zip %} BAIXAR PACOTE (.ZIP) {% else %} BAIXAR ARQUIVO {% endif %}
            </a>
            
            <a href="/" class="btn-action btn-restart">
                NOVA CONVERS√ÉO
            </a>
        </div>
        {% endif %}
    </div>
</div>

</body>
</html>